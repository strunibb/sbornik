<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Сборник лучших песен</title>

  <!-- Tailwind + Icons + Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#6366f1;--secondary:#8b5cf6;--accent:#ec4899;
      --dark:#0f172a;--darker:#0b1020;--light:#e2e8f0
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{
      margin:0;color:var(--light);font-family:'Poppins',sans-serif;line-height:1.6;overflow-x:hidden;
      background:
        radial-gradient(1200px 1200px at 10% -20%, rgba(99,102,241,.14), transparent 60%),
        radial-gradient(1200px 1200px at 110% 120%, rgba(236,72,153,.12), transparent 60%),
        linear-gradient(135deg,var(--darker) 0%, var(--dark) 100%);
      min-height:100vh;
      overscroll-behavior-y: contain;
      -webkit-tap-highlight-color: transparent;
      padding-bottom: max(16px, env(safe-area-inset-bottom));
    }

    /* --- Hero --- */
    .header-title{
      font-family:'Montserrat',sans-serif;font-weight:800;letter-spacing:.2px;
      font-size:clamp(2.2rem,5vw,3.6rem);
      background:linear-gradient(90deg,#f472b6,#8b5cf6,#60a5fa);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      text-shadow:0 10px 30px rgba(139,92,246,.25);
      background-size:200% 100%;
      animation:gradientShift 8s ease-in-out infinite;
    }
    @keyframes gradientShift{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .glass{background:rgba(15,23,42,.55);border:1px solid rgba(99,102,241,.18);backdrop-filter:blur(12px)}
    .glass-strong{background:rgba(15,23,42,.72);border:1px solid rgba(99,102,241,.28);backdrop-filter:blur(14px)}

    /* --- Song cards --- */
    .song-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
    .song-item{
      border:1px solid rgba(99,102,241,.18);background:rgba(15,23,42,.66);backdrop-filter:blur(8px);
      border-radius:16px;padding:14px;cursor:pointer;transition:.25s;position:relative;overflow:hidden
    }
    .song-item:hover{transform:translateY(-3px);border-color:rgba(139,92,246,.55);box-shadow:0 12px 24px -8px rgba(99,102,241,.35)}
    .song-item.selected{
      border-color:#8b5cf6;box-shadow:0 0 24px rgba(139,92,246,.55) inset, 0 12px 30px -10px rgba(139,92,246,.35);
      background:linear-gradient(135deg, rgba(99,102,241,.22), rgba(139,92,246,.22))
    }
    .song-title{font-family:'Montserrat',sans-serif;font-weight:700;font-size:1rem;line-height:1.25;word-break:break-word}
    .song-artist{font-size:.9rem;color:#a3bffa;word-break:break-word}
    .guitar-icon{width:46px;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(99,102,241,.14);transition:.25s}
    .song-item:hover .guitar-icon{transform:rotate(6deg) scale(1.04);background:rgba(99,102,241,.24)}

    /* --- Search --- */
    .search-box{width:100%;background:rgba(30,41,59,.7);border:1px solid rgba(99,102,241,.2);color:#fff;padding:16px 54px;border-radius:50px}
    .search-box:focus{outline:none;border-color:var(--secondary);box-shadow:0 0 0 4px rgba(139,92,246,.22)}
    .search-icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:#94a3b8}
    .clear-search{position:absolute;right:16px;top:50%;transform:translateY(-50%);color:#94a3b8;cursor:pointer}
    .highlight{background:rgba(236,72,153,.3);border-radius:4px;padding:0 2px}

    /* --- Chips / artists --- */
    .chip{
      background:linear-gradient(90deg,rgba(99,102,241,.20),rgba(236,72,153,.20));
      border:1px solid rgba(236,72,153,.35);
      border-radius:999px;padding:10px 14px;white-space:nowrap;cursor:pointer;transition:.2s;
      box-shadow:inset 0 0 18px rgba(139,92,246,.2), 0 0 22px rgba(236,72,153,.15);
      font-size:0.95rem
    }
    .chip:hover{transform:translateY(-1px);filter:saturate(1.1)}
    .chip.active{border-color:#fff;box-shadow:0 0 0 2px rgba(255,255,255,.25), inset 0 0 24px rgba(139,92,246,.35)}
    .chips-wrap{overflow:auto;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch}
    .chips-wrap::-webkit-scrollbar{height:8px}
    .chips-wrap::-webkit-scrollbar-thumb{background:rgba(148,163,184,.35);border-radius:999px}

    /* --- Cart --- */
    .cart-item{background:rgba(30,41,59,.7);border:1px solid rgba(99,102,241,.24);border-radius:12px}
    .remove-btn{transition:.25s}
    .remove-btn:hover{transform:scale(1.06);background:rgba(239,68,68,.22)}

    /* --- Floating buttons --- */
    #toCartFloating{
      position:fixed;left:50%;transform:translateX(-50%);bottom:max(14px, env(safe-area-inset-bottom));z-index:900;display:none;
      background:linear-gradient(90deg,#8b5cf6,#ec4899);color:#fff;border:none;padding:13px 20px;border-radius:999px;
      box-shadow:0 12px 26px rgba(236,72,153,.35),0 0 40px rgba(139,92,246,.4);font-weight:700
    }
    #toCartFloating.show{display:flex}
    .badge{
      position:absolute;top:-8px;right:-8px;background:#10b981;color:#fff;border-radius:999px;font-size:.75rem;padding:2px 7px;
      border:2px solid rgba(15,23,42,.8)
    }
    #toTop{
      position:fixed;right:12px;bottom:calc(max(64px, env(safe-area-inset-bottom)) + 12px);z-index:850;display:none;
      background:rgba(30,41,59,.85);border:1px solid rgba(99,102,241,.35);color:#fff;border-radius:12px;padding:10px 12px
    }
    #toTop.show{display:block}

    /* --- Inputs --- */
    .contact-input{
      width:100%;background:rgba(30,41,59,.7);border:1px solid rgba(99,102,241,.24);color:#fff;
      padding:14px 14px;border-radius:12px;transition:.2s
    }
    .contact-input:focus{outline:none;border-color:var(--secondary);box-shadow:0 0 0 3px rgba(139,92,246,.22)}

    /* --- Notification toast --- */
    .notification{position:fixed;right:18px;bottom:24px;background:linear-gradient(90deg,#10b981,#06b6d4);color:#fff;
      padding:12px 16px;border-radius:12px;transform:translateY(140%);transition:.4s;z-index:1000;box-shadow:0 10px 24px rgba(0,0,0,.25);font-weight:600}
    .notification.show{transform:translateY(0)}

    /* --- Reveal on scroll --- */
    .reveal{opacity:0;transform:translateY(10px);transition:opacity .5s ease, transform .5s ease}
    .reveal.in{opacity:1;transform:none}

    @media(max-width:768px){
      .song-grid{grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
      @media (max-width:380px){
        .song-grid{grid-template-columns:repeat(1,minmax(0,1fr))}
      }
      .guitar-icon{width:42px;height:42px}
      .song-title{font-size:1rem}.song-artist{font-size:.9rem}.header-title{font-size:2.1rem}
    }
  </style>
</head>

<body class="pb-28">
  <div class="relative overflow-hidden">
    <!-- Animated aura shapes -->
    <div class="pointer-events-none absolute -top-24 -left-24 w-72 h-72 rounded-full blur-3xl opacity-30"
         style="background:radial-gradient(circle at 30% 30%, #8b5cf6 0%, transparent 60%)"></div>
    <div class="pointer-events-none absolute -bottom-16 -right-16 w-80 h-80 rounded-full blur-3xl opacity-30"
         style="background:radial-gradient(circle at 70% 70%, #ec4899 0%, transparent 60%)"></div>

    <div class="container mx-auto px-4 max-w-7xl">
      <!-- HEADER -->
      <header class="pt-10 md:pt-14 mb-8 text-center">
        <div class="flex justify-center mb-6">
          <div class="glass p-5 rounded-2xl shadow-xl inline-flex">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-5 rounded-full">
              <i class="fas fa-guitar text-white text-4xl"></i>
            </div>
          </div>
        </div>
        <h1 class="header-title mb-2">Сборник лучших песен</h1>
        <p class="opacity-80 max-w-2xl mx-auto">Выбирайте треки, фильтруйте по исполнителю, добавляйте в корзину и отправляйте заявку прямо в Telegram.</p>
      </header>

      <!-- ARTISTS FILTER (sticky) -->
      <section class="glass-strong rounded-3xl shadow-2xl p-5 md:p-6 mb-8 sticky z-30" style="top: max(6px, env(safe-area-inset-top))">
        <div class="flex items-center justify-between gap-4 flex-wrap">
          <div class="flex items-center gap-3">
            <span class="font-extrabold text-lg" style="font-family:'Montserrat',sans-serif">
              Исполнители
            </span>
            <span id="artistMeta" class="text-xs opacity-75"></span>
          </div>
          <div class="flex items-center gap-2 w-full md:w-auto">
            <div class="relative flex-1">
              <span class="search-icon"><i class="fa-solid fa-user"></i></span>
              <input id="artistSearch" class="search-box" placeholder="Быстрый поиск исполнителя…">
              <span id="artistSearchClear" class="clear-search hidden"><i class="fas fa-times"></i></span>
            </div>
            <button id="artistClear" class="px-3 py-2 rounded-xl bg-slate-700/70 hover:bg-slate-600 transition text-sm">
              Сбросить
            </button>
          </div>
        </div>
        <div id="artistChips" class="chips-wrap mt-4 flex gap-2 py-2"></div>
      </section>

      <!-- TEXT SEARCH -->
      <div class="max-w-2xl mx-auto mb-8 relative">
        <span class="search-icon"><i class="fas fa-search"></i></span>
        <input id="search-input" class="search-box" placeholder="Поиск по названию или артисту...">
        <span id="clear-search" class="clear-search hidden"><i class="fas fa-times"></i></span>
      </div>

      <!-- SONGS -->
      <section class="glass rounded-3xl shadow-2xl p-6">
        <div class="mb-6 text-center">
          <h2 class="font-extrabold text-xl md:text-2xl inline-block pb-2 relative" style="font-family:'Montserrat',sans-serif">
            Список песен
          </h2>
          <div class="mt-2 text-sm opacity-80">
            Отсортировано по артистам: А–Я, затем A–Z • Всего: <b id="totalCount">0</b> • Показано: <b id="shownCount">0</b>
          </div>
        </div>

        <div id="song-list" class="song-grid"></div>
        <div id="no-results" class="text-center opacity-80 py-8 hidden">
          <i class="fa-regular fa-face-sad-tear text-2xl mb-2"></i>
          <div>Ничего не найдено…</div>
        </div>
        <div id="sentinel" class="text-center text-sm opacity-70 py-6 hidden">Загружаем ещё…</div>
      </section>

      <!-- CART -->
      <section id="cartSection" class="glass rounded-3xl shadow-2xl p-6 mt-10 hidden border-t-4 border-indigo-500">
        <div class="flex items-center justify-between mb-4 flex-wrap gap-3">
          <div class="flex items-center gap-3">
            <span class="chip"><i class="fa-solid fa-basket-shopping mr-1"></i> В корзине: <b id="cartCount">0</b></span>
          </div>
          <div class="flex gap-2">
            <button id="copyBtn" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 transition">Скопировать список</button>
            <button id="clearBtn" class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 transition">Очистить</button>
          </div>
        </div>

        <div id="cartList" class="grid md:grid-cols-2 gap-3"></div>

        <!-- ORDER FORM -->
        <form id="orderForm" class="mt-8 grid md:grid-cols-2 gap-4">
          <input class="contact-input" id="buyerName" placeholder="Ваше имя"/>
          <input class="contact-input" id="buyerContact" placeholder="Контакт (Telegram @ник, телефон или WhatsApp)"/>
          <textarea class="contact-input md:col-span-2" id="buyerComment" rows="3" placeholder="Комментарий (по желанию)"></textarea>
          <button id="sendOrder" type="submit" class="md:col-span-2 px-5 py-3 rounded-xl font-semibold text-white
            bg-gradient-to-r from-fuchsia-600 via-purple-600 to-indigo-600 hover:opacity-95 transition shadow-lg">
            <i class="fa-regular fa-paper-plane mr-2"></i>Отправить заявку на покупку песен
          </button>
          <div class="text-xs opacity-70 md:col-span-2">Заявка приходит в Telegram. Мы свяжемся с вами для подтверждения.</div>
        </form>
      </section>
    </div>
  </div>

  <!-- Floating cart button -->
  <button id="toCartFloating" class="relative">
    <i class="fa-solid fa-cart-shopping mr-2"></i>
    <span>Перейти к корзине</span>
    <span id="floatBadge" class="badge hidden">0</span>
  </button>

  <!-- Back to top -->
  <button id="toTop" title="Наверх"><i class="fa-solid fa-arrow-up"></i></button>

  <!-- Toast -->
  <div id="notify" class="notification"><i class="fa-solid fa-check mr-2"></i><span></span></div>

  <script>
  // ================== RAW LIST ==================
  const RAW_LIST = `
Би-2 — Мы не ангелы, парень
Бортпроводник — Давай сбежим
Бумбокс — Та что
Егор Крид — Девочка с картинки
Егор Крид — Надо ли
Женя Трофимов — Все они о тебе (feat. Комната Культуры)
Женя Трофимов — Поезда
HENSY — Замок на мостик
HENSY — Пить и курить
Ляпис Трубецкой — В платье белом
ЛСП — Бэйби
Lizer — Быстро повзрослел
Любэ — А зори здесь тихие
Любэ — Есть только миг
Любэ — От Волги до Енисея
Любэ — Позови меня тихо по имени
Любэ — Ты неси меня река
Макс Корж — Мотылёк
Монеточка — Селфхарм
Моя Мишель — Курточка
Найк Борзов — Верхом на звезде
Нервы — Её имя
Нервы — Зажигалки
Нервы — Как как надо
Нервы — Кофе — мой друг
Нервы — Слишком влюблён
Нервы — Суицид моей веры
Папин Олимпос — Школа
Песни из кино — Девчата — Старый клён
Пицца — Лифт
Порнофильмы — Я так соскучился
Просто Лера — Лютики
Пятница — Нева
Рожден Ануси — Знаешь, душа моя рваная
Руки Вверх! — Когда мы были молодыми
Руки Вверх! — Он тебя целует
Руки Вверх! — Чужие губы
Сектор Газа — Твой звонок
Сергей Лазарев — В самое сердце
Сергей Трофимов — Алёшка
Сергей Трофимов — Ветерок
Сергей Трофимов — Я скучаю по тебе
Feduk — Краски
Feduk — Хлопья летят наверх
Юлий Ким — Губы окаянные
5’nizza — Весна
5’nizza — Зима
5’nizza — Моя Ямайка
5’nizza — Стрела
5’nizza — Ты кидал
5’nizza — Я солдат
7Б — Молодые ветра
7Б — Неизвестный солдат
7Б — Осень
7Б — Последний герой
Агата Кристи — Как на войне
Агата Кристи — Сказочная тайга
Александр Розенбаум — Ау
Александр Розенбаум — Братан
Александр Розенбаум — Вальс-бостон
Александр Розенбаум — Гоп-стоп
Александр Розенбаум — Черный тюльпан
Алексин Андрей — Малолетние шалавы
Алиса — Небо славян
Амега — Лететь
Армейская песня — Здравствуй, небо в облаках
Ария — Возьми моё сердце
Ария — Встань, страх преодолей
Ария — Герой асфальта
Ария — Замкнутый круг
Ария — Осколок льда
Ария — Там высоко
Ария — Штиль
Ахра — Карие глаза
Баста — Выпускной (Медлячок)
Баста — Сансара
Баста — Темная ночь
Би-2 — Варвара
Би-2 — Мой рок-н-ролл
Би-2 — Серебро
Божья Коровка — Гранитный камушек
Браво — Ветер знает
Браво — Любите, девушки
Бременские музыканты — Ничего на свете лучше нету
Братья Грим — Ресницы
Бумбокс — Вахтерам
Бумбокс — Летний дождь
Бумбокс — Пепел
Бумбокс — Хоттабыч
Валентин Стрыкало — 92
Валентин Стрыкало — Всё решено
Валентин Стрыкало — Гори
Валентин Стрыкало — Дешёвые драмы
Валентин Стрыкало — Знаешь, Таня
Валентин Стрыкало — Наше лето
Валентин Стрыкало — Офисный стиляга
Валентин Стрыкало — Он постоянно что-то ест
Валентин Стрыкало — Песня для девочек
Валентин Стрыкало — Рустем
Валентин Стрыкало — Серёжка
Валентин Стрыкало — фанк
Валерий Кипелов — Я свободен
Виктор Цой — Каждую ночь
Виктор Цой — Город
Владимир Высоцкий — Песня о друге
Владимир Высоцкий — Песня о сентиментальном боксере
Владимир Высоцкий — Я не люблю
Градусы — Голая
Градусы — Режиссер
Гречка — Здесь были
Гречка — Люби меня
Гречка — Твои руки
Дайте танк (!) — Друг
Дайте танк (!) — Курьер
Дайте танк (!) — Маленький
Дайте танк (!) — Мы
Дайте танк (!) — Спам
Дайте танк (!) — Сюрприз
Дайте танк (!) — Утро
Dabro — Билет
Dabro — Давай запоём
Dabro — Два крыла
Dabro — Дальше — больше
Dabro — Мне не страшно
Dabro — На крыше
Dabro — На часах ноль-ноль
Dabro — Полюбил тебя
Dabro — Поцелуй
Dabro — Солнце и Луна
Dabro — Ты знаешь, мам
Dabro — Я по частицам
Dabro — Всё за одного
ДДТ — Что такое осень
Денис Майданов — Вечная любовь
Джизус — Век эвтаназии
Джизус — Открой глаза
Дора — Дорадура
Дора — Дорадура (ремикс)
Дора — ЕК
Дора — Осень пьяная
Дора — Поздно (feat. Feduk)
Евгений Белоусов — Девчонка-девчоночка
Егор Крид — Будильник
Егор Крид — Дым (feat. JONY)
Егор Крид — Если ты меня не любишь (feat. Molly)
Егор Крид — Невеста
Егор Крид — Надо ли
Егор Крид — Самая-самая
Егор Крид — Завтра
Егор Крид — Завтра (feat. Баста)
Егор Крид — Папина дочка
Женя Трофимов — Ветерок
Женя Трофимов — Голуби
Женя Трофимов — Город Сочи
Женя Трофимов — Иномарка
Женя Трофимов — Корабли
Женя Трофимов — Корабли (перебор)
Женя Трофимов — Море
Женя Трофимов — Ночь
Женя Трофимов — Первая любовь (feat. Комната Культуры)
Женя Трофимов — Привет
Женя Трофимов — Пусть она поёт
Женя Трофимов — Родина
Женя Трофимов — Самолёты
Женя Трофимов — Я скучаю по тебе
Жуки — Батарейка
Жуки — Танкист
Жуки — Влечение
Звери — Брюнетки и блондинки
Звери — Для тебя
Звери — До скорой встречи
Звери — Напитки покрепче
Звери — Районы-кварталы
Звери — Танцуй
Звери — Всё, что касается
Звери — Просто такая сильная любовь
Земляне — Трава у дома
Земфира — Аривадерчи
Земфира — Бесконечность
Земфира — В метро
Земфира — Искала
Земфира — Ромашки
Земфира — Хочешь
Иванушки International — Тополиный пух
Игорь Скляр — Комарово
IOWA — Простая песня
Канги — Эйя
Кино — Алюминиевые огурцы
Кино — Апрель
Кино — Атаман
Кино — Группа крови
Кино — Дальше, действовать будем мы
Кино — Звезда по имени Солнце
Кино — Когда твоя девушка больна
Кино — Кукушка
Кино — Красно-желтые дни
Кино — Легенда
Кино — Малыш
Кино — Мама, мы все тяжело больны
Кино — Нам с тобой
Кино — Невесёлая песня
Кино — Ночь
Кино — Пачка сигарет
Кино — Перемен
Кино — Печаль
Кино — Попробуй спеть вместе со мной
Кино — Сосны на морском берегу
Кино — Спокойная ночь
Кино — Стук
Кино — Закрой за мной дверь
Клава Кока, Hensy — Костер
Колизей — Имя твоё
Король и Шут — Внезапная голова
Король и Шут — Воспоминания о былой любви
Король и Шут — Гробовщик
Король и Шут — Два друга и разбойники
Король и Шут — Дурак и молния
Король и Шут — Ели мясо мужики
Король и Шут — Камнем по голове
Король и Шут — Кукла колдуна
Король и Шут — Лесник
Король и Шут — Маска
Король и Шут — Марионетки
Король и Шут — Мёртвый анархист
Король и Шут — На краю
Король и Шут — Отражение
Король и Шут — Помнят с горечью древляне
Король и Шут — Проклятый старый дом
Король и Шут — Прыгну со скалы
Король и Шут — Северный флот
Король и Шут — Счастье
Король и Шут — Танец злобного гения
Король и Шут — Тяни
Король и Шут — Фокусник
Круг Михаил — Девочка пай
Круг Михаил — Исповедь
Круг Михаил — Кольщик
Круг Михаил — Приходите в мой дом
Круг Михаил — Роза
Круг Михаил — Тебе моя последняя любовь
Круг Михаил — Тишина
Ласковый Май — Белые розы
Ласковый Май — Детство
Ласковый Май — Розовый вечер
Леонид Агутин — На сиреневой луне
Леонид Агутин — Хоп-хэй Ла-ла-лей
Ленинград — В Питере — пить
Ленинград — Экспонат
Lizer — Быстро повзрослел
ЛСП — Парный дурак
Любэ — Берёзы
Любэ — Конь
Любэ — Там за туманами
Любэ — Солдат
МакSим — Знаешь ли ты
Макс Корж — 2 типа людей
Макс Корж — В темноте
Макс Корж — Жить в кайф
Макс Корж — Малиновый закат
Макс Корж — Мотылёк
Макс Корж — Небо поможет нам
Макс Корж — Слово пацана
Макс Корж — Эндорфин
Мельница — Дороги
Мельница — Королева
Мираж — Музыка нас связала
Михаил Боярский — Зеленоглазое такси
Михаил Круг — Девочка пай
Михаил Круг — Фраер 2
Многоточие — Щемит в груди
Монеточка — Каждый раз
Монеточка — Нимфоманка
Монеточка — Папина любовница
Монеточка — Селфхарм
Монеточка — Запорожец
Моя Мишель — Курточка
Мумий Тролль — Девочка
Мумий Тролль — Медведица
Мумий Тролль — Утекай
Мумий Тролль — Забавы
Наутилус Помпилиус — Крылья
Наутилус Помпилиус — Одинокая птица
Наутилус Помпилиус — Прогулки по воде
Наутилус Помпилиус — Скованные одной цепью
Наутилус — Я хочу быть с тобой
Нервы — Батареи
Нервы — Да или…
Нервы — Её имя
Нервы — Как как надо
Нервы — Кофе мой друг
Нервы — Самый дорогой человек
Нервы — Счастье
Нервы — Слишком влюблён
Нервы — Суета моей веры
Нервы — Я не хочу без тебя спать
Ногу Свело! — Наши юные смешные голоса
Олег Митяев — Как здорово, что все мы здесь сегодня собрались
Олег Митяев — Изгиб гитары жёлтой
Папин Олимпос — День, когда мы все встретились с тобой
Папин Олимпос — Динозаврики
Папин Олимпос — Официантка
Папин Олимпос — Сегодня не пойду гулять
Папин Олимпос — Снежинка
Папин Олимпос — Темно-оранжевый закат
Песни из кино и мультфильмов — Девчата (Старый клён)
Песни из кино и мультфильмов — Свадьба в Малиновке
Песни из кино и мультфильмов — Бременские музыканты
Пицца — Оружие
Пицца — Романс
Пицца — Тише
Пицца — Улыбка
Пицца — Фарами
Порнофильмы — Прости, прощай, привет
Порнофильмы — Я так соскучился
Пошлая Молли — Контракт
Пошлая Молли — Любимая песня твоей сестры
Рождество — Ты знаешь, так хочется жить
Руки Вверх! — 18 мне уже
Руки Вверх! — Алешка
Руки Вверх! — Девчонка
Руки Вверх! — Когда мы были молодыми
Руки Вверх! — Крошка моя
Руки Вверх! — Он тебя целует
Руки Вверх! — Студент
Руки Вверх! — Чужие губы
Сектор Газа — 30 лет
Сектор Газа — Бомж
Сектор Газа — Казачья
Сектор Газа — Колхозный панк
Сектор Газа — Life
Сектор Газа — Лирика
Сектор Газа — Свидание
Сектор Газа — Туман
Сектор Газа — Твой звонок
Сектор Газа — Ява
Сергей Лазарев — В самое сердце
Сергей Трофимов — Голуби
Сергей Трофимов — Город Сочи
Сергей Трофимов — Иномарка
Сергей Трофимов — Московская песня
Сергей Трофимов — Родина
Сергей Трофимов — Снегири
Сергей Трофимов — Алексей
Сергей Трофимов — Привет
Сергей Трофимов — Ветерок
Сергей Трофимов — Я скучаю по тебе
Скриптонит — Вечеринка
Скриптонит — Где твоя любовь
Скриптонит — Космос
Скриптонит — Не забирай меня с пати
Скриптонит — Танцуй сама
Сплин — Двое не спят
Сплин — Орбит без сахара
Сплин — Танцуй
Стас Михайлов — Без тебя
Танцы Минус — Город
Танцы Минус — Половинка
Танцы Минус — Ю
Татьяна Куртукова — Матушка
Татьяна Куртукова — Одного
Тима Белорусских — Незабудка
Тимур Муцураев — Милые зелёные глаза
Тимур Муцураев — Твоя нежная походка
Три дня дождя — Космос
Три дня дождя — Осень и алкоголь
Три дня дождя — Отпускай
Тринадцать Карат — Во снах
Тринадцать Карат — В моей голове
Тринадцать Карат — Из-за тебя
Тринадцать Карат — Пока он тебя не бросит
Тринадцать Карат — Последний лепесток
Фактор 2 — Война
Фактор 2 — Красавица
Фактор 2 — Марихуана 3000
Фактор 2 — Шалава
Фактор 2 — Одинокая звезда
Feduk — Моряк
Feduk — Запрети мне носить AirMax
Feduk — Хлопья летят наверх
Чайф — Аргентина — Ямайка 5:0
Чайф — Бутылка кефира, полбатона
Чайф — Никто не услышит (Ой-ёй)
Чиж & Co — Фантом
Чиж — 18 берёз
Юлий Ким — Губы окаянные
Юта — Жили-были
Justin Bieber — Love Yourself
Justin Bieber — Mistletoe
Justin Bieber — Sorry
Justin Bieber — What Do You Mean
KSB Muzic — Осень
Lida — Фото со звездой
Måneskin — I Wanna Be Your Slave
MiyaGi — По уши в тебя влюблён
MiyaGi & Andy Panda — Fire Man
MiyaGi & Andy Panda — Kosandra
MiyaGi & Andy Panda — Патрон
Miyagi & Эндшпиль — Bounty
Miyagi & Эндшпиль — Фея
Miyagi & Эндшпиль feat. NERAK — Именно та
Ssshhiiittt! — Засыпай
Ssshhiiittt! — Тебя нет
Xcho — Ты и я
Xolidayboy — Кино
Xolidayboy — Мания
Xolidayboy — Мотыльки
Xolidayboy — Моя хулиганка
Xolidayboy — Мы не будем спать
Xolidayboy — Океаны
Xolidayboy — Пожары
`;

  // ================== TELEGRAM SETTINGS ==================
  const BOT_TOKEN = "7598736914:AAHVJUOt7okTfMh1VE_l1ZrCqaXv-r1PcWI";
  const CHAT_ID  = "725158536";

  // ================== UTILS ==================
  const $ = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
  const normRu = s => (s||'').toString().toLowerCase().replace(/ё/g,'е').trim();
  const asciiApos = s => (s||'').replace(/[’`]/g,"'");

  // Алиасы/нормализация артистов (ключ — нормализованный)
  const ALIAS = new Map([
    ["hensy","Hensy"],
    ["круга михаил","Михаил Круг"],["круг михаил","Михаил Круг"],
    ["юля ким","Юлий Ким"],
    ["дабро (dabro)","Dabro"],["дabro","Dabro"],
    ["валерий кипелов","Ария"],
    ["виктор цой","Кино"],
    ["наутилус","Наутилус Помпилиус"],
    ["песни из кино","Песни из кино и мультфильмов"],
    ["чиж","Чиж & Co"],
    ["пятница","5'nizza"],
    ["5’nizza","5'nizza"],
    ["miyagi & эндшпиль feat. nerak","Miyagi & Эндшпиль"],
    ["miyagi & эндшпиль","Miyagi & Эндшпиль"],
    ["miyagi & andy panda","Miyagi & Эндшпиль"],
    ["miyagi & andy panda","Miyagi & Эндшпиль"],
    ["miYagi & andy panda".toLowerCase(),"Miyagi & Эндшпиль"]
  ]);

  const DONT_SPLIT_AMP = new Set(["Miyagi & Эндшпиль","Чиж & Co"]);

  const cleanName = s => asciiApos(normRu(s)).replace(/\s+/g,' ').trim();

  const applyAlias = (name) => {
    const key = cleanName(name);
    return ALIAS.get(key) || name.trim();
  };

  // Разбиваем совместных артистов на массив для фильтра (Клава Кока, Hensy)
  function splitArtists(raw){
    const aliasedWhole = applyAlias(raw);
    if (DONT_SPLIT_AMP.has(aliasedWhole)) return [aliasedWhole];

    // Разделители: запятая, feat/ft, x
    let parts = raw.split(/\s*,\s*|\s+feat\.?\s+|\s+ft\.?\s+|\s+x\s+/i);
    // Если остался амперсанд и это не «Чиж & Co»/«Miyagi & Эндшпиль», разделим по нему
    if (parts.length === 1 && !DONT_SPLIT_AMP.has(aliasedWhole) && /\s&\s/.test(raw)) {
      parts = raw.split(/\s&\s/);
    }
    const mapped = [...new Set(parts.map(p=>applyAlias(p)))].filter(Boolean);
    // Если всё равно ничего не вышло — вернём алиас целиком
    return mapped.length ? mapped : [aliasedWhole];
  }

  // Приводим весь artist к каноническому виду (включая совместки)
  function canonicalArtist(raw){
    const arr = splitArtists(raw);
    return arr.join(', ');
  }

  // Парсинг и очистка
  function parseSongs(raw){
    const lines = raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
    const skipByPhrase = (s) => /пропуск|если есть/i.test(s) || /см\./i.test(s) || /см\s/i.test(s) || /Дукатура/i.test(s);
    const songs = [];
    const seen = new Set();

    for(const line of lines){
      if(!line.includes('—')) continue;
      if(skipByPhrase(line)) continue;

      const firstDash = line.indexOf('—');
      let artist = line.slice(0, firstDash).trim();
      let title  = line.slice(firstDash+1).trim();

      title = title.replace(/\([^)]*\)/g,'').replace(/\s{2,}/g,' ').trim();
      artist = artist.replace(/\([^)]*\)/g,'').trim();
      title = title.replace(/(\d)\s*[:]\s*(\d)/g,'$1-$2'); // 5:0 -> 5-0

      // применяем канон
      const displayArtist = canonicalArtist(artist);
      const artistList = splitArtists(artist);

      const key = normRu(displayArtist)+'—'+normRu(title);
      if(seen.has(key)) continue;
      seen.add(key);

      if(!displayArtist || !title) continue;

      songs.push({artist: displayArtist, title, artists: artistList});
    }
    return songs;
  }

  // Сортировка: кириллица → латиница; затем артист, затем трек
  const isCyr = s => /^[а-яё]/i.test(s||'');
  function sortSongs(arr){
    return arr.sort((a,b)=>{
      const aC = isCyr(a.artist), bC = isCyr(b.artist);
      if(aC!==bC) return aC? -1 : 1;
      const cmpA = a.artist.toLocaleLowerCase('ru').localeCompare(b.artist.toLocaleLowerCase('ru'),'ru');
      if(cmpA!==0) return cmpA;
      return a.title.toLocaleLowerCase('ru').localeCompare(b.title.toLocaleLowerCase('ru'),'ru');
    });
  }

  // ================== STATE/REFS ==================
  const songList = $('#song-list');
  const totalCountEl = $('#totalCount');
  const shownCountEl = $('#shownCount');
  const searchInput = $('#search-input');
  const clearSearch = $('#clear-search');
  const cartSection = $('#cartSection');
  const cartList = $('#cartList');
  const cartCount = $('#cartCount');
  const notify = $('#notify');
  const toCartFloating = $('#toCartFloating');
  const floatBadge = $('#floatBadge');
  const toTopBtn = $('#toTop');
  const sentinel = $('#sentinel');

  const artistChips = $('#artistChips');
  const artistSearch = $('#artistSearch');
  const artistSearchClear = $('#artistSearchClear');
  const artistClear = $('#artistClear');
  const artistMeta = $('#artistMeta');

  const ALL_SONGS = sortSongs(parseSongs(RAW_LIST));
  totalCountEl.textContent = ALL_SONGS.length;

  const selected = new Map(); // key -> {title, artist}
  let q = '';                 // text search
  let artistFilter = '';      // current artist filter

  // Виртуализация списка
  let filteredCache = [];
  let visibleLimit = 0;
  const BATCH = 80; // шаг подгрузки (мобильный-friendly)

  function computeFiltered(){
    const n = normRu(q);
    return ALL_SONGS.filter(s=>{
      const hitSearch = !n || normRu(s.title).includes(n) || normRu(s.artist).includes(n);
      const hitArtist = !artistFilter || s.artists.includes(artistFilter);
      return hitSearch && hitArtist;
    });
  }

  function renderChunk(start, end){
    for (let i=start;i<end;i++){
      const s = filteredCache[i]; if(!s) break;
      const card = document.createElement('div');
      card.className = 'song-item reveal';
      card.dataset.title = s.title;
      card.dataset.artist = s.artist;
      card.innerHTML = `
        <div class="flex items-start gap-3">
          <div class="guitar-icon"><i class="fas fa-music text-indigo-300"></i></div>
          <div class="flex-1 min-w-0">
            <div class="song-title">${s.title}</div>
            <div class="song-artist">${s.artist}</div>
          </div>
        </div>
        <div class="absolute right-2 top-2 opacity-80">${selected.has(`${s.title}::${s.artist}`)?'<i class="fa-solid fa-check text-emerald-400"></i>':''}</div>
      `;
      card.addEventListener('click', ()=>toggleSelect(card));
      songList.appendChild(card);
    }
  }

  function renderSongs(){
    songList.innerHTML = '';
    filteredCache = computeFiltered();
    visibleLimit = Math.min(BATCH, filteredCache.length);
    renderChunk(0, visibleLimit);

    $('#no-results').classList.toggle('hidden', filteredCache.length>0);
    shownCountEl.textContent = Math.min(visibleLimit, filteredCache.length);

    // highlight search matches
    const nn = normRu(q);
    if(nn){
      $$('.song-item').forEach(el=>{
        const tEl = el.querySelector('.song-title'), aEl = el.querySelector('.song-artist');
        const t = el.dataset.title, a = el.dataset.artist;
        const paint = src=>{
          const srcN = normRu(src); const i = srcN.indexOf(nn);
          if(i<0) return src;
          return src.substring(0,i) + '<span class="highlight">'+ src.substring(i, i+q.length) +'</span>' + src.substring(i+q.length);
        };
        tEl.innerHTML = paint(t); aEl.innerHTML = paint(a);
      });
    }

    sentinel.classList.toggle('hidden', visibleLimit>=filteredCache.length);
    revealObserve();
  }

  // Подгрузка по пересечению sentinel
  const loadObserver = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting && visibleLimit < filteredCache.length){
        const next = Math.min(visibleLimit + BATCH, filteredCache.length);
        renderChunk(visibleLimit, next);
        visibleLimit = next;
        shownCountEl.textContent = visibleLimit;
        sentinel.classList.toggle('hidden', visibleLimit>=filteredCache.length);
        revealObserve();
      }
    });
  },{root:null,threshold:0.01});
  loadObserver.observe(sentinel);

  // ================== ARTISTS CHIPS ==================
  const ARTISTS = (()=> {
    const set = new Set();
    ALL_SONGS.forEach(s=>s.artists.forEach(a=>set.add(a)));
    return Array.from(set).sort((a,b)=>{
      const aC = isCyr(a), bC = isCyr(b);
      if(aC!==bC) return aC? -1 : 1;
      return a.toLocaleLowerCase('ru').localeCompare(b.toLocaleLowerCase('ru'),'ru');
    });
  })();

  function renderArtistChips(filterText=''){
    artistChips.innerHTML = '';
    const needle = normRu(filterText);
    let list = ARTISTS.filter(a => !needle || normRu(a).includes(needle));

    artistMeta.textContent = `Всего исполнителей: ${ARTISTS.length}${needle ? ` • найдено: ${list.length}`:''}`;

    list.forEach(name=>{
      const btn = document.createElement('button');
      btn.className = 'chip text-sm';
      btn.textContent = name;
      btn.setAttribute('title', `Показать песни: ${name}`);
      if(name === artistFilter) btn.classList.add('active');
      btn.addEventListener('click', ()=>{
        artistFilter = (artistFilter === name) ? '' : name;
        $$('.chip', artistChips).forEach(c=>c.classList.remove('active'));
        if(artistFilter){
          btn.classList.add('active');
          showNote(`Фильтр: ${artistFilter}`);
        }else{
          showNote('Фильтр исполнителя сброшен');
        }
        renderSongs();
        document.getElementById('song-list').scrollIntoView({behavior:'smooth', block:'start'});
      });
      artistChips.appendChild(btn);
    });
  }

  // ================== CART ==================
  function toggleSelect(el){
    const key = `${el.dataset.title}::${el.dataset.artist}`;
    if(selected.has(key)){
      selected.delete(key);
      el.classList.remove('selected');
    }else{
      selected.set(key, {title: el.dataset.title, artist: el.dataset.artist});
      el.classList.add('selected');
    }
    renderCart();
    const checkSlot = el.querySelector('.absolute.right-2.top-2');
    checkSlot.innerHTML = selected.has(key) ? '<i class="fa-solid fa-check text-emerald-400"></i>' : '';
  }

  function renderCart(){
    cartList.innerHTML = '';
    const arr = Array.from(selected.values());
    cartCount.textContent = arr.length;
    cartSection.classList.toggle('hidden', arr.length===0);
    toCartFloating.classList.toggle('show', arr.length>0);
    floatBadge.textContent = arr.length;
    floatBadge.classList.toggle('hidden', arr.length===0);

    arr.forEach(({title,artist})=>{
      const row = document.createElement('div');
      row.className = 'cart-item p-3 flex items-center justify-between';
      row.innerHTML = `
        <div class="pr-3 min-w-0">
          <div class="font-semibold">${title}</div>
          <div class="text-sm opacity-80">${artist}</div>
        </div>
        <button class="remove-btn px-3 py-2 rounded-md bg-red-600/20 hover:bg-red-600/30">
          <i class="fa-solid fa-xmark"></i>
        </button>`;
      row.querySelector('.remove-btn').addEventListener('click', ()=>{
        selected.delete(`${title}::${artist}`);
        $$('.song-item').forEach(el=>{
          if(el.dataset.title===title && el.dataset.artist===artist) el.classList.remove('selected');
        });
        renderCart();
      });
      cartList.appendChild(row);
    });
  }

  function showNote(text){
    notify.querySelector('span').textContent = text;
    notify.classList.add('show');
    setTimeout(()=>notify.classList.remove('show'), 1600);
  }

  // ================== SEARCH ==================
  searchInput.addEventListener('input', ()=>{
    q = searchInput.value;
    clearSearch.classList.toggle('hidden', !q.length);
    renderSongs();
  });
  clearSearch.addEventListener('click', ()=>{
    searchInput.value=''; q='';
    clearSearch.classList.add('hidden'); renderSongs();
  });

  // ================== ARTIST SEARCH/CLEAR ==================
  artistSearch.addEventListener('input', ()=>{
    const v = artistSearch.value;
    artistSearchClear.classList.toggle('hidden', !v.length);
    renderArtistChips(v);
  });
  artistSearchClear.addEventListener('click', ()=>{
    artistSearch.value=''; artistSearchClear.classList.add('hidden'); renderArtistChips('');
  });
  artistClear.addEventListener('click', ()=>{
    artistFilter = '';
    artistSearch.value = ''; artistSearchClear.classList.add('hidden');
    renderArtistChips('');
    renderSongs();
  });

  // Горизонтальный скролл чипов — свайпом
  (()=>{
    let isDown=false,startX,scrollLeft;
    artistChips.addEventListener('mousedown',e=>{isDown=true;artistChips.classList.add('cursor-grabbing');startX=e.pageX-artistChips.offsetLeft;scrollLeft=artistChips.scrollLeft;});
    artistChips.addEventListener('mouseleave',()=>{isDown=false;artistChips.classList.remove('cursor-grabbing');});
    artistChips.addEventListener('mouseup',()=>{isDown=false;artistChips.classList.remove('cursor-grabbing');});
    artistChips.addEventListener('mousemove',e=>{if(!isDown)return;e.preventDefault();const x=e.pageX-artistChips.offsetLeft;const walk=(x-startX);artistChips.scrollLeft=scrollLeft-walk;});
  })();

  // ================== CART BUTTONS ==================
  $('#copyBtn').addEventListener('click', async ()=>{
    const text = Array.from(selected.values()).map(s=>`${s.title} — ${s.artist}`).join('\n');
    if(!text){ showNote('Список пуст'); return; }
    try{ await navigator.clipboard.writeText(text); showNote('Скопировано в буфер'); }
    catch(e){ showNote('Не удалось скопировать'); }
  });
  $('#clearBtn').addEventListener('click', ()=>{
    selected.clear(); $$('.song-item').forEach(el=>el.classList.remove('selected'));
    renderCart(); renderSongs(); showNote('Список очищен');
  });
  toCartFloating.addEventListener('click', ()=>{
    document.getElementById('cartSection').scrollIntoView({behavior:'smooth', block:'start'});
  });

  // Кнопка "Наверх"
  window.addEventListener('scroll', ()=>{
    const y = window.scrollY || document.documentElement.scrollTop;
    toTopBtn.classList.toggle('show', y>600);
  });
  toTopBtn.addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));

  // ================== TELEGRAM SUBMIT ==================
  $('#orderForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const arr = Array.from(selected.values());
    if(arr.length===0){ showNote('Добавьте песни в корзину'); return; }
    const name = $('#buyerName').value.trim();
    const contact = $('#buyerContact').value.trim();
    const comment = $('#buyerComment').value.trim();
    if(!name || !contact){ showNote('Укажите имя и контакт'); return; }

    const list = arr.map((s,i)=> `${i+1}. ${s.title} — ${s.artist}`).join('\n');
    const text =
`<b>Новая заявка на покупку песен</b>
👤 Имя: ${name}
📨 Контакт: ${contact}
💬 Комментарий: ${comment || '—'}

<b>Список (${arr.length}):</b>
${list}`;

    try{
      const res = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({chat_id: CHAT_ID, text, parse_mode:'HTML'})
      });
      if(!res.ok) throw new Error('TG error');
      showNote('Заявка отправлена!');
    }catch(err){
      const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${encodeURIComponent(CHAT_ID)}&parse_mode=HTML&text=${encodeURIComponent(text)}`;
      window.open(url,'_blank');
      showNote('Открыли Telegram для отправки');
    }
  });

  // ================== REVEAL ANIMATIONS ==================
  let io;
  function revealObserve(){
    if(io) io.disconnect();
    io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add('in');
          io.unobserve(e.target);
        }
      });
    },{threshold:0.06});
    $$('.reveal', songList).forEach(el=>io.observe(el));
  }

  // ================== INIT ==================
  renderArtistChips('');
  renderSongs();

  </script>
</body>
</html>
